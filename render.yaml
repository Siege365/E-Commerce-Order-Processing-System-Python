# ShopPy - Render Blueprint Configuration
# This file defines the infrastructure for deploying to Render
# See: https://render.com/docs/blueprint-spec

services:
  # Web Service - Django Application
  - type: web
    name: shoppy
    runtime: python
    buildCommand: "./build.sh"
    startCommand: "gunicorn lib.ECommerce.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --threads 4 --worker-class gthread --worker-tmp-dir /dev/shm"
    envVars:
      - key: DJANGO_SECRET_KEY
        generateValue: true
      - key: DEBUG
        value: "False"
      - key: ALLOWED_HOSTS
        value: ".onrender.com"
      - key: PYTHON_VERSION
        value: "3.11.7"
      - key: DATABASE_URL
        fromDatabase:
          name: shoppy-db
          property: connectionString
      - key: WEB_CONCURRENCY
        value: "2"
    autoDeploy: true
    healthCheckPath: /

  # PostgreSQL Database
databases:
  - name: shoppy-db
    databaseName: shoppy
    user: shoppy_user
    plan: free # Change to 'starter' or higher for production

# Instructions for manual setup if not using Blueprint:
#
# 1. Create a new Web Service on Render
# 2. Connect your GitHub/GitLab repository
# 3. Set the following:
#    - Runtime: Python 3
#    - Build Command: ./build.sh
#    - Start Command: gunicorn lib.ECommerce.wsgi:application --bind 0.0.0.0:$PORT
#
# 4. Add Environment Variables:
#    - DJANGO_SECRET_KEY: (generate a secure key)
#    - DEBUG: False
#    - ALLOWED_HOSTS: your-app.onrender.com
#    - DATABASE_URL: (from your Render PostgreSQL)
#    - ADMIN_USERNAME: admin
#    - ADMIN_EMAIL: admin@yourdomain.com
#    - ADMIN_PASSWORD: (secure password)
#
# 5. Create a PostgreSQL database on Render
# 6. Copy the Internal Database URL to DATABASE_URL
